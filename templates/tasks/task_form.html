{% extends 'base.html' %}

{% block title %}
    {% if form.instance.pk %}Vazifani tahrirlash{% else %}Yangi vazifa{% endif %} | TutorCRM
{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <div class="flex items-center gap-2 text-xs font-bold uppercase tracking-widest text-slate-500 mb-6">
        <a href="{% url 'tasks:task_list' %}" class="hover:text-blue-400 transition-colors">Vazifalar</a>
        <i class="fa-solid fa-chevron-right text-[10px]"></i>
        <span class="text-slate-300">{% if form.instance.pk %}Tahrirlash{% else %}Yaratish{% endif %}</span>
    </div>

    <div class="bg-[#0a1631]/50 border border-white/5 backdrop-blur-md rounded-[2.5rem] p-8 md:p-10 shadow-2xl relative overflow-hidden">
        <div class="absolute -top-10 -left-10 w-32 h-32 bg-emerald-600/10 rounded-full blur-3xl"></div>

        <div class="flex items-center gap-5 mb-10">
            <div class="w-14 h-14 rounded-2xl bg-emerald-600/20 border border-emerald-500/30 flex items-center justify-center text-emerald-400 text-2xl">
                <i class="fa-solid fa-file-signature"></i>
            </div>
            <div>
                <h2 class="text-2xl font-black text-white tracking-tight">
                    {% if form.instance.pk %}Vazifani tahrirlash{% else %}Yangi vazifa qoâ€˜shish{% endif %}
                </h2>
                <p class="text-slate-500 text-sm">O'quvchilar uchun topshiriq va muddatlarni belgilang.</p>
            </div>
        </div>

        <form method="POST" class="space-y-6">
            {% csrf_token %}

            <div id="task-type-selection" class="p-4 bg-white/[0.03] rounded-2xl border border-white/5">
                <label class="block text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] mb-4 ml-1">
                    {{ form.task_type.label }}
                </label>
                <div class="flex flex-wrap gap-4">
                    {% for radio in form.task_type %}
                        <label class="relative flex-1 cursor-pointer group">
                            {{ radio.tag }}
                            <div class="w-full py-3 px-4 text-center rounded-xl bg-slate-800/40 border border-white/5 text-slate-400 font-bold text-sm transition-all group-hover:bg-white/5 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:shadow-[0_0_15px_rgba(37,99,235,0.3)]">
                                {{ radio.choice_label }}
                            </div>
                        </label>
                    {% endfor %}
                </div>
            </div>

            <div class="space-y-2">
                <label class="block text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] ml-1">{{ form.title.label }}</label>
                {{ form.title }}
                {% if form.title.errors %}<p class="text-red-400 text-xs italic mt-1">{{ form.title.errors.0 }}</p>{% endif %}
            </div>
            
            <div class="space-y-2">
                <label class="block text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] ml-1">{{ form.description.label }}</label>
                {{ form.description }}
                {% if form.description.errors %}<p class="text-red-400 text-xs italic mt-1">{{ form.description.errors.0 }}</p>{% endif %}
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                    <label class="block text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] ml-1">{{ form.due_date.label }}</label>
                    {{ form.due_date }}
                </div>

                <div class="space-y-2">
                    <label class="block text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] ml-1">{{ form.status.label }}</label>
                    {{ form.status }}
                </div>
            </div>

            <div id="target-group-container" class="space-y-2 transition-all duration-300">
                <label class="block text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] ml-1">{{ form.target_group.label }}</label>
                {{ form.target_group }}
            </div>
            
            <div id="target-student-container" class="space-y-2 transition-all duration-300" style="display:none;">
                <label class="block text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] ml-1">Maqsadli o'quvchi</label>
                <div class="p-4 bg-white/5 border border-dashed border-white/10 rounded-2xl text-slate-500 text-sm italic">
                    <i class="fa-solid fa-circle-info mr-2"></i> Student modeli ulangandan so'ng bu yerda o'quvchilar ro'yxati chiqadi.
                </div>
            </div>

            <div class="flex flex-col sm:flex-row justify-end gap-4 pt-8 mt-4 border-t border-white/5">
                <a href="{% url 'tasks:task_list' %}" 
                   class="px-8 py-4 rounded-2xl bg-white/5 border border-white/10 text-slate-400 font-bold hover:bg-white/10 hover:text-white transition-all text-center">
                    Bekor qilish
                </a>
                <button type="submit" 
                        class="px-12 py-4 bg-emerald-600 hover:bg-emerald-500 text-white rounded-2xl font-black uppercase tracking-widest shadow-[0_15px_30px_-10px_rgba(16,185,129,0.4)] transition-all active:scale-95 flex items-center justify-center gap-2">
                    <i class="fa-solid fa-check"></i>
                    Saqlash
                </button>
            </div>
        </form>
    </div>
</div>

<style>
    input[type="text"], input[type="date"], select, textarea {
        width: 100% !important;
        padding: 0.875rem 1.25rem !important;
        background-color: rgba(5, 11, 26, 0.4) !important;
        border: 1px solid rgba(255, 255, 255, 0.08) !important;
        border-radius: 1.25rem !important;
        color: #e2e8f0 !important;
        font-size: 0.875rem !important;
        transition: all 0.3s ease !important;
        outline: none !important;
    }
    input:focus, select:focus, textarea:focus {
        border-color: rgba(16, 185, 129, 0.5) !important;
        background-color: rgba(5, 11, 26, 0.7) !important;
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.1) !important;
    }
    /* Radio peer-checked uchun yashirin input */
    input[name="task_type"] {
        position: absolute;
        opacity: 0;
        width: 0;
        height: 0;
    }
    select option { background: #0a1631; color: white; }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const groupContainer = document.getElementById('target-group-container');
        const studentContainer = document.getElementById('target-student-container');
        const radioInputs = document.querySelectorAll('input[name="task_type"]');

        function toggleTargetField() {
            const selectedRadio = document.querySelector('input[name="task_type"]:checked');
            if (!selectedRadio) return; 

            const selectedValue = selectedRadio.value;

            if (selectedValue === 'Group') {
                groupContainer.style.display = 'block';
                studentContainer.style.display = 'none';
                groupContainer.classList.add('animate-in', 'fade-in', 'slide-in-from-top-2');
            } else if (selectedValue === 'Student') {
                groupContainer.style.display = 'none';
                studentContainer.style.display = 'block';
                studentContainer.classList.add('animate-in', 'fade-in', 'slide-in-from-top-2');
            }
        }

        radioInputs.forEach(radio => {
            radio.addEventListener('change', toggleTargetField);
        });

        toggleTargetField();
    });
</script>
{% endblock %}